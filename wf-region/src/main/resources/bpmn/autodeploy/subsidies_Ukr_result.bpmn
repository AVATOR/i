<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <process id="subsidies_Ukr_result" name="Розрахунок субсидії" isExecutable="true">
    <startEvent id="startevent1" name="Start">
      <extensionElements>
        <activiti:formProperty id="sID_Public_SubjectOrganJoin" name="Оберіть свій район або місто" type="select" default="0" required="true"></activiti:formProperty>
        <activiti:formProperty id="bankIdlastName" name="Призвіще" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="bankIdfirstName" name="Ім'я" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="bankIdmiddleName" name="По батькові" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="bankIdinn" name="ІПН" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="bankIdAddressFactual" name="Домашня адреса" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="phone" name="Контактний номер телефону" type="string" default="+380" required="true"></activiti:formProperty>
        <activiti:formProperty id="email" name="Ваш e-mail;На цей e-mail Ви отримаєте результат обробки Вашого звернення" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="goal_2" name="Чи подавали на субсидію через портал iGov?" type="enum" required="true">
          <activiti:value id="Enum1" name="Так"></activiti:value>
          <activiti:value id="Enum2" name="Ні"></activiti:value>
        </activiti:formProperty>
        <activiti:formProperty id="nZvern" name="Номер звернення" type="string" default=" "></activiti:formProperty>
      </extensionElements>
    </startEvent>
    <serviceTask id="servicetask1" name="Лист-привітання громадянина" activiti:delegateExpression="#{MailTaskWithoutAttachment}">
      <extensionElements>
        <activiti:field name="from">
          <activiti:expression>noreply@igov.org.ua</activiti:expression>
        </activiti:field>
        <activiti:field name="to">
          <activiti:expression>${email}</activiti:expression>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:expression>Звернення на тему: Отримання інформації про призначення субсидії на оплату житлово-комунальних послуг</activiti:expression>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression>[pattern/mail/_common_header.html]
			&lt;h3&gt;Шановний(-а) ${bankIdfirstName} ${bankIdmiddleName}.&lt;/h3&gt;
			&lt;p&gt;
			Ваше звернення щодо отримання інформації про призначення субсидії на оплату житлово-комунальних послуг успішно зареєстроване.&lt;br /&gt;
			Ви отримаєте відповідь протягом п'яти робочих днів.
			&lt;/p&gt;
			&lt;p&gt;Контакти підрозділу соцзахисту, яке буде займатися обробкою Вашого звернення:&lt;/p&gt;
&lt;p&gt;[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:2]
&lt;br /&gt;
[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:3]
&lt;br /&gt;
[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:4]
&lt;br /&gt;
[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:5]&lt;/p&gt;
			[pattern/mail/_common_signature_start.html]
			[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:2]
			[pattern/mail/_common_signature_end.html]
			[pattern/mail/_common_footer.html]</activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <serviceTask id="servicetask2" name="Повідомлення держслужбовця" activiti:delegateExpression="#{MailTaskWithoutAttachment}">
      <extensionElements>
        <activiti:field name="from">
          <activiti:expression>noreply@igov.org.ua</activiti:expression>
        </activiti:field>
        <activiti:field name="to">
          <activiti:expression>lomova_aleksandra@mail.ru</activiti:expression>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:expression>Нове звернення на порталі igov.org.ua на тему: Отримання інформації про призначення субсидії на оплату житлово-комунальних послуг. Заявник ${bankIdlastName} ${bankIdfirstName} ${bankIdmiddleName}</activiti:expression>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression>[pattern/mail/_common_employee_notify.html]</activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <sequenceFlow id="flow1" sourceRef="servicetask1" targetRef="servicetask2"></sequenceFlow>
    <userTask id="usertask1" name="Перевірка даних" activiti:candidateGroups="${group}">
      <extensionElements>
        <activiti:formProperty id="bankIdlastName" name="Призвіще" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="bankIdfirstName" name="Ім'я" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="bankIdmiddleName" name="По батькові" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="bankIdinn" name="ІПН" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="bankIdAddressFactual" name="Домашня адресса" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="phone" name="Контактний номер телефону" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="email" name="Контактний e-mail" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="goal" name="Заявнику призначено субсидію?" type="enum">
          <activiti:value id="Enum1" name="Субсидія нараховується (додайте файл з розрахунком)"></activiti:value>
          <activiti:value id="Enum2" name="Заява на субсидію в процесі обробки"></activiti:value>
          <activiti:value id="Enum3" name="Субсидія не призначалась"></activiti:value>
        </activiti:formProperty>
        <activiti:formProperty id="result" name="Додайте файл з розрахунком, якщо субсидію призначено" type="file"></activiti:formProperty>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow2" sourceRef="servicetask2" targetRef="usertask1"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway1" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow3" sourceRef="usertask1" targetRef="exclusivegateway1"></sequenceFlow>
    <serviceTask id="servicetask3" name="Скан розрахунку" activiti:delegateExpression="#{MailTaskWithAttachments}">
      <extensionElements>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="to">
          <activiti:expression>${email}</activiti:expression>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:string><![CDATA[Отримання інформації про призначення субсидії на оплату житлово-комунальних]]></activiti:string>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression>[pattern/mail/_common_header.html]
		    &lt;h3&gt;Шановний(-а) ${bankIdfirstName} ${bankIdmiddleName}.&lt;/h3&gt;
			&lt;p&gt;Результат Вашого звернення з приводу призначення субсидії наведено нижче у вигляді сканфото.   &lt;/p&gt;
			[pattern/mail/_common_signature_start.html]
			&lt;p&gt;[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:2]
			&lt;/p&gt;
            [pattern/mail/_common_signature_end.html]
			[pattern/mail/_common_footer.html]</activiti:expression>
        </activiti:field>
        <activiti:field name="saAttachmentsForSend">
          <activiti:expression>${result}</activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <sequenceFlow id="flow4" name="Заявка прийнята " sourceRef="exclusivegateway1" targetRef="servicetask3">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${goal=='Enum1'}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask4" name="В процесі обробці" activiti:delegateExpression="#{MailTaskWithoutAttachment}">
      <extensionElements>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="to">
          <activiti:expression>${email}</activiti:expression>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:string><![CDATA[Отримання інформації про призначення субсидії на оплату житлово-комунальних]]></activiti:string>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression>[pattern/mail/_common_header.html]
		    &lt;h3&gt;Шановний(-а) ${bankIdfirstName} ${bankIdmiddleName}.&lt;/h3&gt;
			&lt;p&gt;Ваше звернення з приводу призначення субсидії знаходиться в опрацюванні. За результатом розгляду Вас буде проінформовано за допомогою вказаного Вами e-mail.  &lt;/p&gt;
			[pattern/mail/_common_signature_start.html]
			&lt;p&gt;[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:2]
			&lt;/p&gt;
            [pattern/mail/_common_signature_end.html]
			[pattern/mail/_common_footer.html]</activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <sequenceFlow id="flow5" name="Заявка в процесі обробки" sourceRef="exclusivegateway1" targetRef="servicetask4">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${goal=='Enum2'}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask6" name="Відмова" activiti:delegateExpression="#{MailTaskWithoutAttachment}">
      <extensionElements>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="to">
          <activiti:expression>${email}</activiti:expression>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:string><![CDATA[Отримання інформації про призначення субсидії на оплату житлово-комунальних]]></activiti:string>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression>[pattern/mail/_common_header.html]
		    &lt;h3&gt;Шановний(-а) ${bankIdfirstName} ${bankIdmiddleName}.&lt;/h3&gt;
			&lt;p&gt;За даними УПСЗН субсидія не призначалась. &lt;/p&gt;
			&lt;p&gt;За необхідності Ви можете подати дані на призначення субсидіі  на порталі &lt;a href="https://igov.org.ua/" target="_blank"&gt;igov.org.ua&lt;/a&gt;&lt;/p&gt;
			[pattern/mail/_common_signature_start.html]
			&lt;p&gt;[pattern_dictonary:dnepr_soc_help.csv:value{[rName]}:2]
			&lt;/p&gt;
                     [pattern/mail/_common_signature_end.html]
			[pattern/mail/_common_footer.html]</activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <sequenceFlow id="flow7" name="Субсидія не призначалась" sourceRef="exclusivegateway1" targetRef="servicetask6">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${goal=='Enum3'}]]></conditionExpression>
    </sequenceFlow>
    <endEvent id="endevent1" name="End"></endEvent>
    <sequenceFlow id="flow8" sourceRef="servicetask4" targetRef="endevent1"></sequenceFlow>
    <endEvent id="endevent2" name="End"></endEvent>
    <sequenceFlow id="flow9" sourceRef="servicetask3" targetRef="endevent2"></sequenceFlow>
    <endEvent id="endevent3" name="End"></endEvent>
    <sequenceFlow id="flow10" sourceRef="servicetask6" targetRef="endevent3"></sequenceFlow>
    <sequenceFlow id="flow11" sourceRef="scripttask1" targetRef="servicetask1"></sequenceFlow>
    <scriptTask id="scripttask1" name="Script Task" scriptFormat="javascript" activiti:autoStoreVariables="false">
      <script>
var no = [ "1", "2", "3"]
var gr = [ "upszn1", "upszn2", "upszn3"]
var So = [ "s1", "s2", "s3"]
for (var i = 0; i&lt;697; i++){
var per = So[i]
if(execution.getVariable('sID_Public_SubjectOrganJoin') == per){
var per1 = gr[i]
var per2 = no[i]
break}}
execution.setVariable('group', per1)
execution.setVariable('rName', per2)
</script>
    </scriptTask>
    <sequenceFlow id="flow12" sourceRef="startevent1" targetRef="scripttask1"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_subsidies_Ukr_result">
    <bpmndi:BPMNPlane bpmnElement="subsidies_Ukr_result" id="BPMNPlane_subsidies_Ukr_result">
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="64.0" y="40.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask1" id="BPMNShape_servicetask1">
        <omgdc:Bounds height="61.0" width="105.0" x="150.0" y="130.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask2" id="BPMNShape_servicetask2">
        <omgdc:Bounds height="68.0" width="105.0" x="300.0" y="127.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask1" id="BPMNShape_usertask1">
        <omgdc:Bounds height="55.0" width="105.0" x="450.0" y="134.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway1" id="BPMNShape_exclusivegateway1">
        <omgdc:Bounds height="40.0" width="40.0" x="600.0" y="142.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask3" id="BPMNShape_servicetask3">
        <omgdc:Bounds height="55.0" width="105.0" x="728.0" y="135.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask4" id="BPMNShape_servicetask4">
        <omgdc:Bounds height="55.0" width="105.0" x="568.0" y="260.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask6" id="BPMNShape_servicetask6">
        <omgdc:Bounds height="55.0" width="105.0" x="568.0" y="30.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="718.0" y="270.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent2" id="BPMNShape_endevent2">
        <omgdc:Bounds height="35.0" width="35.0" x="878.0" y="145.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent3" id="BPMNShape_endevent3">
        <omgdc:Bounds height="35.0" width="35.0" x="718.0" y="40.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="scripttask1" id="BPMNShape_scripttask1">
        <omgdc:Bounds height="55.0" width="105.0" x="29.0" y="127.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="255.0" y="160.0"></omgdi:waypoint>
        <omgdi:waypoint x="300.0" y="161.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="405.0" y="161.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="161.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="555.0" y="161.0"></omgdi:waypoint>
        <omgdi:waypoint x="600.0" y="162.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4">
        <omgdi:waypoint x="640.0" y="162.0"></omgdi:waypoint>
        <omgdi:waypoint x="728.0" y="162.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="91.0" x="628.0" y="169.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow5" id="BPMNEdge_flow5">
        <omgdi:waypoint x="620.0" y="182.0"></omgdi:waypoint>
        <omgdi:waypoint x="620.0" y="260.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="629.0" y="218.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7">
        <omgdi:waypoint x="620.0" y="142.0"></omgdi:waypoint>
        <omgdi:waypoint x="620.0" y="85.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="580.0" y="95.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow8" id="BPMNEdge_flow8">
        <omgdi:waypoint x="673.0" y="287.0"></omgdi:waypoint>
        <omgdi:waypoint x="718.0" y="287.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow9" id="BPMNEdge_flow9">
        <omgdi:waypoint x="833.0" y="162.0"></omgdi:waypoint>
        <omgdi:waypoint x="878.0" y="162.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow10" id="BPMNEdge_flow10">
        <omgdi:waypoint x="673.0" y="57.0"></omgdi:waypoint>
        <omgdi:waypoint x="718.0" y="57.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow11" id="BPMNEdge_flow11">
        <omgdi:waypoint x="134.0" y="154.0"></omgdi:waypoint>
        <omgdi:waypoint x="150.0" y="160.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow12" id="BPMNEdge_flow12">
        <omgdi:waypoint x="81.0" y="75.0"></omgdi:waypoint>
        <omgdi:waypoint x="81.0" y="127.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>